<div
  class="filters"
  aria-label="Filtres de produits"
>
  <mat-form-field
    appearance="outline"
    floatLabel="always"
    class="category-field"
  >
    <mat-label>Catégorie</mat-label>

    <mat-select
      [value]="selectedCategory()"
      (valueChange)="onCategoryChange($event)"
      aria-labelledby="category-filter-label"
    >
      <mat-option id="category-filter-label" value="All">Toutes</mat-option>
      <mat-option value="Food">Nourriture</mat-option>
      <mat-option value="Medecine">Médicaments</mat-option>
      <mat-option value="Books">Livres</mat-option>
      <mat-option value="Electric">Électrique</mat-option>
      <mat-option value="Parfum">Parfum</mat-option>
    </mat-select>
  </mat-form-field>
</div>

<div class="products-container">
  @for (p of products(); track p.id) {
    <mat-card class="product-card">
      <mat-card-header>
        <mat-card-title>{{ p.productName? p.productName: "no name" }}</mat-card-title>
        <mat-card-subtitle>
          {{ p.category }}
          <p class="price">
            Prix HT : {{ p.price | currency:'EUR':'symbol':'1.2-2' }}<br />
            Prix TTC : {{ p.unitPriceTtc | currency:'EUR':'symbol':'1.2-2' }}
          </p>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="stock" [class.unavailable]="p.quantity === 0">
          @if (p.quantity > 0) {
            Stock : {{ p.quantity }}
          } @else {
            <strong>Non disponible</strong>
          }
        </p>

        <div class="qty-container">
          @if (p.quantity > 0) {
            <mat-form-field appearance="outline">
              <mat-label>Quantité</mat-label>
              <input
                matInput
                type="number"
                min="1"
                [max]="p.quantity"
                [(ngModel)]="selectedQty[p.id]"
                (ngModelChange)="onQtyChange(p)"
              />
            </mat-form-field>
          } @else {
            <div class="qty-placeholder"></div>
          }
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button
          mat-raised-button
          color="primary"
          (click)="addToCart(p)"
          [disabled]="isAddDisabled(p)"
        >
          Ajouter au panier
        </button>
      </mat-card-actions>
    </mat-card>
  }
</div>
